---
title: "Case Studies"
output:
  html_document:
    df_print: paged
---
```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(plotly)
library(rgdal)
library(spatstat)
library(sf)
library(viridis)
library(classInt)
library(ggmap)
library(raster)
library(rgeos)
library(rgdal)
library(gridExtra)
library(rasterVis)
require(spatialEco)
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Load hex.sent
load("plots/hex.sent") # Twitter / Instagram hex level data
load("plots/twitter.pa.sent") # Twitter planning area level data
load("plots/insta.pa.sent") # Instagram planning area level data
load("plots/richpoor.sent") # Rich / poor data
load("plots/time1.data") # SGT 00:00 - 05:59 
load("plots/time2.data") # SGT 06:00 - 11:59  
load("plots/time3.data") # SGT 12:00 - 17:59 
load("plots/time4.data") # SGT 18:00 - 23:59
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
class_int <- classIntervals(twitter.pa.sent$norm, n = 4, style = "jenks")
rounded <- round(class_int$brks,3)
rounded[1] <- 0 

p <- ggplot() +
  geom_sf(data = twitter.pa.sent, aes(fill = cut(norm, class_int$brks), geometry = geometry, text = paste0(Name, "\n", "Sentiment: ", norm)), lwd = 0) + 
  theme_void() +
  coord_sf() +
  scale_fill_viridis(
    name="Normalized Sentiment",
    discrete = T,
    labels = c(rounded),
    guide=guide_legend(
      keyheight = unit(2, units = "mm"),
      keywidth=unit(18, units = "mm"),
      label.position = "bottom",
      title.position = 'top',
      nrow=1)) +
  labs(
    title = "Twitter Sentiments in Different Planning Zones",
    subtitle = "Normalized Sentiment score = (Positive - Negative)/Total Count",
    caption = "Data: Ate Poorthuis | Creation: Dragon Minions"
  ) +
  theme(
    text = element_text(color = "#22211d"),
    plot.background = element_rect(fill = "#ffffff", color = NA),
    panel.background = element_rect(fill = "#ffffff", color = NA),
    legend.background = element_rect(fill = "#ffffff", color = NA),
    plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 0, unit = "cm")),
    legend.position = c(0.81, 0.09),
    panel.grid.major = element_line(colour = 'transparent'),
    panel.grid.minor = element_line(colour = 'transparent')
  )

p
# ggplotly(p, tooltip = "text") %>%
#  highlight(
#    "plotly_hover",
#    opacityDim = 1
#  ) %>%
#   layout(legend = list(
#     orientation = 'h',
#     x = 0.1,
#     y = 0.1,
#     title = "Normalized Sentiment"))
```

From this map, we can see that people are the happiest around Sentosa, Marina Bay and Sungei Buloh Wetland reserve from the tweets. This makes sense as they are tourist attractions and are more likely visited by people for recreation. People tend to post tweets of enjoyment in their trips.

We can also tell that industrial islands in the south of Singapore are the least happy places. This could be the fact that people visiting the islands are likely there for mundane/tough industrial work, and tend to tweet about negative moods.

We can also see that the central of Singapore is slightly happier than the outskirts of the country. This may be due to the fact that the central of Singapore is bustling with more recreational activities and night-life. Tourists also tend to mainly explore the central regions of Singapore. This can result in more positive posts towards the centre of Singapore.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
class_int <- classIntervals(insta.pa.sent$norm, n = 4, style = "jenks")
rounded <- round(class_int$brks,3)
rounded[1] <- 0

p <- ggplot() +
  geom_sf(data = insta.pa.sent, aes(fill = cut(norm, class_int$brks), geometry = geometry, text = paste0(Name, "\n", "Sentiment: ", norm)), lwd = 0) + 
  theme_void() +
  coord_sf() +
  scale_fill_viridis(
    name="Normalized Sentiment",
    discrete = T,
    labels = rounded,
    guide=guide_legend(
      keyheight = unit(2, units = "mm"),
      keywidth=unit(18, units = "mm"),
      label.position = "bottom",
      title.position = 'top',
      nrow=1)) +
  labs(
    title = "Instagram Sentiment in Different Planning Zones",
    subtitle = "Normalized Sentiment score = (Positive - Negative)/Total Count",
    caption = "Data: Ate Poorthuis | Creation: Dragon Minions"
  ) +
  theme(
    text = element_text(color = "#22211d"),
    plot.background = element_rect(fill = "#ffffff", color = NA),
    panel.background = element_rect(fill = "#ffffff", color = NA),
    legend.background = element_rect(fill = "#ffffff", color = NA),
    plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    legend.position = c(0.81, 0.09),
    panel.grid.major = element_line(colour = 'transparent'),
    panel.grid.minor = element_line(colour = 'transparent')
  )

p
```

At first glance, this map looks very similar to the previous map, with a few exceptions. It makes sense for both maps to be similar since both sets of data came from the social media. However, it is interesting to look at the differences. The differences in sentiments shown by the two sets of data, is likely to be due to the fact that Singaporeans tend to use Instagram more than Twitter. Tweets are more likely to come from tourists while Instagram posts are more likely to come from Singaporeans. 

Firstly, the instagram posts made from the North-Eastern Islands are less happy than the tweets posted from the same area. The North-Eastern Islands include two main islands, Pulau Ubin, which is a tourist attraction, and Palau Tekong, which is a military territory where a lot of young Singaporean men are forced to serve the nation. Hence, tweets from the North-Eastern Islands are likely to have come from tourists, while instagram posts from likely to have come from unhappy NS boys. 

The second exception we can see, is the Punggol-Pasir Ris area. This area has many parks, and is a place where many Singaporeans go to to relax on the weekends. Moreover, this place is not yet a tourist attraction (according to Jing Yu, he strongly objected). Hence, this results in less happy tweets (mainly from tourists) and more happy tweets from Singaporeans. 

In general, the happiest areas are Punggol, Pasir Ris, Tanglin, Marina Bay and Ang Mo Kio, Changi Bay. This can be a result of higher recreational activities in these areas. Pasir Ris and Punggol have many parks, Tanglin has shopping centre and Botanical Gardens, Marina Bay is a tourist attraction and Ang Mo Kio has night-life and food places.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
class_int <- classIntervals(hex.sent$t.norm, n = 5, style = "jenks")
rounded <- round(class_int$brks,3)

p <- ggplot() +
  geom_sf(data = hex.sent, aes(fill=cut(t.norm, class_int$brks), geometry=geometry, text=paste0("Sentiment: ", t.norm)), lwd=0) + 
  theme_void() +
  coord_sf() +
  scale_fill_viridis(
    name="Normalized Sentiment",
    discrete=T,
    labels = rounded,
    guide=guide_legend(
      keyheight = unit(2, units = "mm"),
      keywidth=unit(12, units = "mm"),
      label.position = "bottom",
      title.position = 'top',
      nrow=1)) +
  labs(
    title = "Twitter Sentiment in Singapore",
    subtitle = "Normalized Sentiment score = (Positive - Negative)/Total Count",
    caption = "Data: Ate Poorthuis | Creation: Dragon Minions"
  ) +
  theme(
    text = element_text(color = "#22211d"), 
    plot.background = element_rect(fill = "#ffffff", color = NA), 
    panel.background = element_rect(fill = "#ffffff", color = NA), 
    legend.background = element_rect(fill = "#ffffff", color = NA),
    plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    legend.position = c(0.82, 0.09),
    panel.grid.major = element_line(colour = 'transparent'), 
    panel.grid.minor = element_line(colour = 'transparent')
  )

p
```

Using a hex map, we can view the spatial data in higher granularity. From this map, we can see that Tekong, Tuas, the industrial islands, Tanah Merah Coast Road and Changi Airport are the least happy areas. We know from the previous map that there are actually twitter posts in Tekong. Tweets in Tekong could be unhappy as the National Service Forces or National Service Men dread serving in the military. For Tanah Merah Coast Road, Tuas and industrial islands, people could be unhappy during their working hours. Lim Chu Kang Road has many cemetaries and forested area, and this could mean generally more negative tweets.

We can also see that areas like Bukit Timah Nature Reserve, Marina Bay, Sentosa and Sungei Boloh Wetland Reserve are the happiest. This is because they are prime recreational areas for both tourists and locals.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
class_int <- classIntervals(hex.sent$i.norm, n = 5, style = "jenks")
rounded <- round(class_int$brks,3)

p <- ggplot() +
  geom_sf(data = hex.sent, aes(fill=cut(i.norm, class_int$brks, include.lowest = TRUE), geometry=geometry, text=paste0("Sentiment: ", i.norm)), lwd=0) + 
  theme_void() +
  coord_sf() +
  scale_fill_viridis(
    name="Normalized Sentiment",
    discrete=T,
    labels = rounded,
    guide=guide_legend(
      keyheight = unit(2, units = "mm"),
      keywidth=unit(12, units = "mm"),
      label.position = "bottom",
      title.position = 'top',
      nrow=1)) +
  labs(
    title = "Instagram Sentiment in Singapore",
    subtitle = "Normalized Sentiment score = (Positive - Negative)/Total Count",
    caption = "Data: Ate Poorthuis | Creation: Dragon Minions"
  ) +
  theme(
    text = element_text(color = "#22211d"), 
    plot.background = element_rect(fill = "#ffffff", color = NA), 
    panel.background = element_rect(fill = "#ffffff", color = NA), 
    legend.background = element_rect(fill = "#ffffff", color = NA),
    plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    legend.position = c(0.79, 0.09),
    panel.grid.major = element_line(colour = 'transparent'), 
    panel.grid.minor = element_line(colour = 'transparent')
  )

p
```

From this map, we can see that Tuas, Lim Chu Kang Road, Tekong, Jurong Island, Woodlands, Yishun, Pulau Ubin and Changi Airport are the least happy. This map supports the inferences from the tweets data in areas like Tuas, Jurong Island, Lim Chu Kang Road and Tekong. given that these are data from two different social media platforms, the inferences seem to be justified. There are also some similarities in the rest of the areas that are least happy wen compared to the tweets data (other than Changi Airport).

When we compare Instagram to Twitter, we can see that posts on Instagram are generally happier. This can be due to the nature of Instagram where more photos are being shared instead of just posting a mood. This can mean that people tend to post less unhappy posts on Instagram as they may not want to blatantly show their negative moods. Twitter on the other hand mainly uses text posts where it appears less expressive. People can just post a simple caption or statement to express their mood in a more subtle manner.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
hex.sent.odds <- hex.sent
hex.sent.odds[hex.sent.odds$odds == 0,]$odds <- NA
hex.sent.odds[hex.sent.odds$i.count < 10,]$odds <- NA
hex.sent.odds[hex.sent.odds$t.count < 10,]$odds <- NA
hex.sent.na <- hex.sent.odds %>% filter(is.na(odds))

class_int <- classIntervals(hex.sent.odds$odds, n = 7, style = "quantile")
rounded <- round(class_int$brks,2)

breaks <- c(0,0.3,0.8,1.1,1.5,222)
colors <- c("#03392B", "#37988D", "#86D0C3", "#edfdff", "#A3C2F8", "#76A7E9", "#0B5FC2")

p <- ggplot() +
  geom_sf(data = hex.sent.odds, aes(fill=cut(odds, breaks = class_int$brks, include.lowest = T), geometry=geometry, text=paste0("Odds Ratio: ", odds)), lwd=0) + 
  theme_void() +
  coord_sf() +
  scale_fill_manual(
    values = colors,
    name="Odds Ratio",
    labels = rounded,
    guide=guide_legend(
      keyheight = unit(2, units = "mm"),
      keywidth=unit(12, units = "mm"),
      label.position = "bottom",
      title.position = 'top',
      nrow=1)) +
  labs(
    title = "Sentiment Odds Ratio in Singapore",
    subtitle = "Odds ratio = (Twitter Sentiment) / (Instagram Sentiment)",
    caption = "Data: Ate Poorthuis | Creation: Dragon Minions"
  ) +
  theme(
    text = element_text(color = "#22211d"), 
    plot.background = element_rect(fill = "#ffffff", color = NA), 
    panel.background = element_rect(fill = "#ffffff", color = NA), 
    legend.background = element_rect(fill = "#ffffff", color = NA),
    plot.title = element_text(size= 22, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    legend.position = c(0.745, 0.06),
    panel.grid.major = element_line(colour = 'transparent'), 
    panel.grid.minor = element_line(colour = 'transparent')
  ) + 
  geom_sf(data = hex.sent.na, lwd = 0)

p
# ggplotly(p, tooltip = "text") %>%
#  highlight(
#    "plotly_hover",
#    opacityDim = 1
#  )
```

From this map, we can see that posts in Twitter are generally less happy than Instagram. There are more blue hexagons than green hexagons. This means that the happiness score on twitter is generally lower than instagram, resulting in low odds ratio.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
time1 <- time1 %>% mutate(norm = (i.norm + t.norm)/2)
class_int <- classIntervals(time1$norm, n = 5, style = "jenks")
rounded <- round(class_int$brks,3)

p <- ggplot() +
  geom_sf(data = time1, aes(fill=cut(norm, class_int$brks), geometry=geometry, text=paste0("Sentiment: ", norm)), lwd=0) + 
  theme_void() +
  coord_sf() +
  scale_fill_viridis(
    name="Normalized Sentiment",
    discrete=T,
    labels = rounded,
    guide=guide_legend(
      keyheight = unit(2, units = "mm"),
      keywidth=unit(12, units = "mm"),
      label.position = "bottom",
      title.position = 'top',
      nrow=1)) +
  labs(
    title = "Sentiments in Singapore from 00:00 to 05:59",
    subtitle = "Normalized Sentiment score = (Positive - Negative)/Total Count",
    caption = "Data: Ate Poorthuis | Creation: Dragon Minions"
  ) +
  theme(
    text = element_text(color = "#22211d"), 
    plot.background = element_rect(fill = "#ffffff", color = NA), 
    panel.background = element_rect(fill = "#ffffff", color = NA), 
    legend.background = element_rect(fill = "#ffffff", color = NA),
    plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    legend.position = c(0.82, 0.09),
    panel.grid.major = element_line(colour = 'transparent'), 
    panel.grid.minor = element_line(colour = 'transparent')
  )

p
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
time2 <- time2 %>% mutate(norm = (i.norm + t.norm)/2)
#class_int <- classIntervals(time2$norm, n = 5, style = "jenks")
#rounded <- round(class_int$brks,3)

p <- ggplot() +
  geom_sf(data = time2, aes(fill=cut(norm, class_int$brks), geometry=geometry, text=paste0("Sentiment: ", norm)), lwd=0) + 
  theme_void() +
  coord_sf() +
  scale_fill_viridis(
    name="Normalized Sentiment",
    discrete=T,
    labels = rounded,
    guide=guide_legend(
      keyheight = unit(2, units = "mm"),
      keywidth=unit(12, units = "mm"),
      label.position = "bottom",
      title.position = 'top',
      nrow=1)) +
  labs(
    title = "Sentiments in Singapore from 06:00 to 11:59",
    subtitle = "Normalized Sentiment score = (Positive - Negative)/Total Count",
    caption = "Data: Ate Poorthuis | Creation: Dragon Minions"
  ) +
  theme(
    text = element_text(color = "#22211d"), 
    plot.background = element_rect(fill = "#ffffff", color = NA), 
    panel.background = element_rect(fill = "#ffffff", color = NA), 
    legend.background = element_rect(fill = "#ffffff", color = NA),
    plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    legend.position = c(0.82, 0.09),
    panel.grid.major = element_line(colour = 'transparent'), 
    panel.grid.minor = element_line(colour = 'transparent')
  )

p
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
time3 <- time3 %>% mutate(norm = (i.norm + t.norm)/2)
#class_int <- classIntervals(time2$norm, n = 5, style = "jenks")
#rounded <- round(class_int$brks,3)

p <- ggplot() +
  geom_sf(data = time3, aes(fill=cut(norm, class_int$brks), geometry=geometry, text=paste0("Sentiment: ", norm)), lwd=0) + 
  theme_void() +
  coord_sf() +
  scale_fill_viridis(
    name="Normalized Sentiment",
    discrete=T,
    labels = rounded,
    guide=guide_legend(
      keyheight = unit(2, units = "mm"),
      keywidth=unit(12, units = "mm"),
      label.position = "bottom",
      title.position = 'top',
      nrow=1)) +
  labs(
    title = "Sentiments in Singapore from 12:00 to 17:59",
    subtitle = "Normalized Sentiment score = (Positive - Negative)/Total Count",
    caption = "Data: Ate Poorthuis | Creation: Dragon Minions"
  ) +
  theme(
    text = element_text(color = "#22211d"), 
    plot.background = element_rect(fill = "#ffffff", color = NA), 
    panel.background = element_rect(fill = "#ffffff", color = NA), 
    legend.background = element_rect(fill = "#ffffff", color = NA),
    plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    legend.position = c(0.82, 0.09),
    panel.grid.major = element_line(colour = 'transparent'), 
    panel.grid.minor = element_line(colour = 'transparent')
  )

p
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
time4 <- time4 %>% mutate(norm = (i.norm + t.norm)/2)
#class_int <- classIntervals(time2$norm, n = 5, style = "jenks")
#rounded <- round(class_int$brks,3)

p <- ggplot() +
  geom_sf(data = time4, aes(fill=cut(norm, class_int$brks), geometry=geometry, text=paste0("Sentiment: ", norm)), lwd=0) + 
  theme_void() +
  coord_sf() +
  scale_fill_viridis(
    name="Normalized Sentiment",
    discrete=T,
    labels = rounded,
    guide=guide_legend(
      keyheight = unit(2, units = "mm"),
      keywidth=unit(12, units = "mm"),
      label.position = "bottom",
      title.position = 'top',
      nrow=1)) +
  labs(
    title = "Sentiments in Singapore from 18:00 to 23:59",
    subtitle = "Normalized Sentiment score = (Positive - Negative)/Total Count",
    caption = "Data: Ate Poorthuis | Creation: Dragon Minions"
  ) +
  theme(
    text = element_text(color = "#22211d"), 
    plot.background = element_rect(fill = "#ffffff", color = NA), 
    panel.background = element_rect(fill = "#ffffff", color = NA), 
    legend.background = element_rect(fill = "#ffffff", color = NA),
    plot.title = element_text(size= 18, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    legend.position = c(0.82, 0.09),
    panel.grid.major = element_line(colour = 'transparent'), 
    panel.grid.minor = element_line(colour = 'transparent')
  )

p
```
